# Do not edit this file, it will be overwritten on update.

# This file contains *depecrated* rules kept only for backward
# compatibility reasons. Indeed upstream has the bad habit to change
# symlink naming schemes hence breaking systems using the old schemes.
#
# If your system uses one of the symlinks generated by these compat
# rules (usually in /etc/fstab), we encourage you to replace the
# relevant paths with the new ones (symlinks generated by
# 60-persistent-storage.rules).
#
# Thanks !

ACTION=="remove", GOTO="persistent_storage_end"

SUBSYSTEM!="block", GOTO="persistent_storage_end"
KERNEL!="nvme*|sd*", GOTO="persistent_storage_end"

# ignore partitions that span the entire disk
TEST=="whole_disk", GOTO="persistent_storage_end"

#
# Systems without the compat-symlinks-generation file are systems
# installed before compat rules were created. They might be using
# one of those compat symlinks (can be any generation).
#
IMPORT{file}="/usr/lib/udev/compat-symlink-generation"
ENV{COMPAT_SYMLINK_GENERATION}!="?*", ENV{COMPAT_SYMLINK_GENERATION}="1"

#
# Generation #1
#
ENV{COMPAT_SYMLINK_GENERATION}!="1", GOTO="generation_2"

# NVMe links were introduced first via a SUSE specific commit
# (bsc#944132) and upstream gained support later but of course using a
# different scheme. Also note that ID_SERIAL is already used by the
# contemporary rules, see bsc#1048679 for details.
KERNEL=="nvme*", ENV{DEVTYPE}=="disk", ENV{ID_NVME_SERIAL_COMPAT}!="?*", PROGRAM="scsi_id --whitelisted --replace-whitespace -d $devnode", RESULT=="?*", ENV{ID_NVME_SERIAL_COMPAT}="$result"
KERNEL=="nvme*", ENV{DEVTYPE}=="disk", ENV{ID_NVME_SERIAL_COMPAT}=="?*", SYMLINK+="disk/by-id/nvme-$env{ID_NVME_SERIAL_COMPAT}"
KERNEL=="nvme*", ENV{DEVTYPE}=="partition", ENV{ID_NVME_SERIAL_COMPAT}=="?*", SYMLINK+="disk/by-id/nvme-$env{ID_NVME_SERIAL_COMPAT}-part%n"

# SCSI compat links for ATA devices, removed by f6ba1a468cea (boo#769002)
KERNEL=="sd*[!0-9]", ENV{ID_BUS}=="ata", PROGRAM="scsi_id --whitelisted --replace-whitespace -p0x80 -d $devnode", RESULT=="?*", ENV{ID_SCSI_COMPAT}="$result", SYMLINK+="disk/by-id/scsi-$env{ID_SCSI_COMPAT}"
KERNEL=="sd*[0-9]", ENV{ID_SCSI_COMPAT}=="?*", SYMLINK+="disk/by-id/scsi-$env{ID_SCSI_COMPAT}-part%n"

# by-path (parent device path, compat version, only for ATA/NVMe/SAS bus) (bnc#916420)
ENV{DEVTYPE}=="disk", ENV{ID_BUS}=="ata|nvme|scsi", DEVPATH!="*/virtual/*", IMPORT{program}="path_id_compat --compat=1 %p"
ENV{DEVTYPE}=="disk", ENV{ID_PATH_COMPAT1}=="?*", SYMLINK+="disk/by-path/$env{ID_PATH_COMPAT1}"
ENV{DEVTYPE}=="partition", ENV{ID_PATH_COMPAT1}=="?*", SYMLINK+="disk/by-path/$env{ID_PATH_COMPAT1}-part%n"

# This restores the symlinks for SAS disks removed by 66bba0e701b95dc42e (bsc#1040153)
ENV{DEVTYPE}=="disk", ENV{ID_BUS}=="ata|nvme|scsi", DEVPATH!="*/virtual/*", IMPORT{program}="path_id_compat --compat=2 %p"
ENV{DEVTYPE}=="disk", ENV{ID_PATH_COMPAT2}=="?*", SYMLINK+="disk/by-path/$env{ID_PATH_COMPAT2}"
ENV{DEVTYPE}=="partition", ENV{ID_PATH_COMPAT2}=="?*", SYMLINK+="disk/by-path/$env{ID_PATH_COMPAT2}-part%n"

#
# Generation #2
#
LABEL="generation_2"
ENV{COMPAT_SYMLINK_GENERATION}!="1|2", GOTO="persistent_storage_end"

# Currently no compat links of generation 2

LABEL="persistent_storage_end"
